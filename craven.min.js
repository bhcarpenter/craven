(function(){var e,f=[],h=f.slice,j=f.splice,k=f.push,l=f.shift,m=f.pop,n=f.unshift,p=f.map;function q(a,b,c,d){b=[b,c];k.apply(b,d);return j.apply(a,b)}function r(a,b){for(var c={},d=b.length;d--;)c[b[d]]=a[b[d]];return c}function s(a,b){for(var c in b)a[c]=b[c]}function t(a,b){var c=a[b];return"function"===typeof c?c.call(a):c};var u={c:function(a,b,c){this.b||(this.b={},this.f={});this.b[a]||(this.b[a]=[],this.f[a]=[]);this.b[a].push(b);this.f[a].push(c||this)},e:function(a,b,c){var d,g;if(this.b&&(d=this.b[a])&&(g=this.f[a]))for(a=d.length;a--;)if(d[a]==b&&g[a]==c){d.splice(a,1);g.splice(a,1);break}},a:function(a){var b,c,d,g;if(this.b&&(b=this.b[a])&&(c=this.f[a])){b=b.slice(0);c=c.slice(0);g=h.call(arguments,1);g.push(this);for(d=b.length;d--;)b[d].apply(c[d],g)}}};u.on=u.c;u.off=u.e;u.trigger=u.a;function v(a){a&&this.reset(a)}s(v.prototype,u);v.prototype.d={};v.prototype.attributes=[];e=v.prototype;e.reset=function(a){s(this,this.d=r(a,this.attributes))};e.n=function(a){s(this,r(a,this.attributes))};e.toJSON=function(){return r(this,this.attributes)};e.t=function(){};e.m=function(){if(!1!==this.validate()){var a=this.d,b=this.d=this.toJSON(),c,d={},g=!1;for(c in b)b[c]!==a[c]&&(g=d[c]=b[c]);g&&this.a("change",d,a)}};e.r=function(){this.a("destroy")};function w(a){a&&k.apply(this,x(this,a))}w.prototype=[];s(w.prototype,u);w.prototype.modelType=v;e=w.prototype;e.pop=function(){return y(this,m,this.length-1)};e.push=function(){return z(this,arguments,k,this.length)};e.shift=function(){return y(this,l,0)};e.unshift=function(){return z(this,arguments,n,0)};e.splice=function(){var a=arguments,b=x(this,h.call(a,2)),a=q(this,a[0],a[1],b);A(this,a);a.length&&this.a("remove",a);b.length&&this.a("add",b);return a};
function z(a,b,c,d){b=x(a,b);c=c.apply(a,b);a.a("add",b,d);return c}function y(a,b,c){b=b.call(a);A(a,b);b&&a.a("remove",[b],c);return b}e.reset=function(a){a=q(this,0,this.length,x(this,a));A(this,a);this.a("reset",a)};e.remove=function(a){this.l(this.indexOf(a))};e.l=function(a){if(-1!=a){var b=j.call(this,a,1);A(this,b);this.a("remove",b,a)}};e.toJSON=function(){return this.map(function(a){return a.toJSON()})};e.i=function(a,b,c){this.a("change",a,b,c)};
function x(a,b){var c=a.modelType;return p.call(b,function(a){a instanceof c||(a=new c(a));a.c("destroy",this.remove,this);a.c("change",this.i,this);return a},a)}function A(a,b){for(var c=b.length;c--;)b[c].e("destroy",a.remove,a),b[c].c("change",a.i,a)};function B(a,b){a&&s(this,a);if(!this.view&&!b){var c=document.createElement(t(this,"tagName"));s(c,t(this,"attributes"));this.view=c}}function C(){return new B(null,!0)}B.prototype.tagName="div";B.prototype.attributes={};B.prototype.q=function(){};var D=B.prototype.remove=function(){var a=this.view,b=a.parentNode;b&&b.removeChild(a)};function E(a,b,c){B.call(this,b,c);if(this.model=a)a=this.model,a.c("change",F,this),a.c("destroy",H,this)}E.prototype=C();E.prototype.remove=function(){var a=this.model;a.e("change",F,this);a.e("destroy",H,this);D.call(this)};function F(){this.render()}function H(){this.remove()};function I(a,b,c){B.call(this,b,c);this.collection=a;this.j=[];a&&(this.d(a,0),a=this.collection,a.c("add",this.d,this),a.c("remove",this.k,this))}I.prototype=C();I.prototype.modelControllerType=E;I.prototype.remove=function(){var a=this.collection;a.e("add",this.d,this);a.e("remove",this.k,this);D.call(this)};
I.prototype.d=function(a,b){for(var c=document.createDocumentFragment(),d=a.length,g=Array(d),G;d--;)G=g[d]=new this.modelControllerType(a[d]),c.appendChild(G.view);q(this.j,b,0,g);d=this.view;d.insertBefore(c,d.children[b])};I.prototype.k=function(a,b){for(var c=a.length,d=this.j.splice(b,c);c--;)d[c].remove()};var J={h:[],add:function(a,b,c){var d={};d.pattern=RegExp(a.replace(/(^|\/):[\w\d]*(\/|$)/,"$1(.+)$2"));d.s=b;d.p=c;this.h.push(d)},o:function(){var a=this;window.addEventListener("popstate",function(){a.g(location.pathname)},!1)},navigate:function(a){window.history.pushState({},"",a);this.g(a)},g:function(a){for(var b=this.h,c=b.length,d,g;c--;)if(d=b[c],g=d.pattern.exec(a))g.unshift(),d.s.apply(d.p,g)}};var K={};window.Craven=K;K.Events=u;K.Model=v;v.Prototype=function(){return new v};v.prototype.reset=v.prototype.reset;v.prototype.update=v.prototype.n;v.prototype.toJSON=v.prototype.toJSON;v.prototype.validate=v.prototype.t;v.prototype.save=v.prototype.m;v.prototype.destroy=v.prototype.r;K.Collection=w;w.Prototype=function(){return new w};w.prototype.reset=w.prototype.reset;w.prototype.remove=w.prototype.remove;w.prototype.removeAt=w.prototype.l;K.Controller=B;B.Prototype=C;B.prototype.render=B.prototype.q;
B.prototype.remove=B.prototype.remove;K.ModelController=E;E.Prototype=function(){return new E(null,null,!0)};K.CollectionController=I;I.Prototype=function(){return new I(null,null,!0)};K.Router=J;J.add=J.add;J.activate=J.o;J.navigate=J.navigate;}());
